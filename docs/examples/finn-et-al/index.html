<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HiGlass</title>
<style type="text/css">
    .canvasjs-chart-credit {
    display:none;
}
</style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
    <link rel="stylesheet" href="/styles/page.css">
    <link rel="stylesheet" href="/hglib.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.0/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.0/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.5.2/pixi.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.31.0/react-bootstrap.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
</head>
<body >
    <div style="height: 50px" />
        <div style="margin: auto; width: 100%;">
        <div
            id="development-demo"
            style="position: absolute; left: 1rem; top: 1rem; bottom: 1rem; right: 1rem">
        </div>
    </div>
</body>
<script src='/hglib.js'>
</script>
<script>

hglib
  .ChromosomeInfo('//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv')
  .then((chromInfo) => {
    function handleRow(row) {
      const chromosome = 'chr' + row.chr;
      return [
        chromInfo.chrToAbs([chromosome, +row.start]),
        chromInfo.chrToAbs([chromosome, +row.end])
      ];
    }

    function makeViewConf(regions1d) {
      return {
        editable: true,
        zoomFixed: false,
        views: [
          {
            uid: 'aa',
            initialXDomain: [0, 3500000000],
            initialYDomain: [0, 3500000000],
            chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',
            tracks: {
              top: [
                {
                  chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',
                  type: 'horizontal-chromosome-labels',
                  name: 'Chromosome Labels (hg19)',
                  height: 30
                },
                {
                  type: 'horizontal-1d-annotations',
                  options: {
                    regions: regions1d,
                    minRectWidth: 3,
                    fillOpacity: 0.1,
                    stroke: 'blue',
                    strokePos: ['left', 'right'],
                    strokeWidth: 2,
                    strokeOpacity: 0.6,
                  }
                }
              ],
              left: [
                {
                  chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',
                  type: 'vertical-chromosome-labels',
                  name: 'Chromosome Labels (hg19)',
                  width: 30
                }
              ],
              center: [
                {
                  type: 'combined',
                  height: 200,
                  contents: [
                    {
                      server: 'http://higlass.io/api/v1',
                      tilesetUid: 'CQMd6V_cRw6iCI_-Unl3PQ',
                      type: 'heatmap',
                      position: 'center',
                      options: {
                        colorRange: [
                          '#FFFFFF',
                          '#F8E71C',
                          '#F5A623',
                          '#D0021B'
                        ],
                        colorbarPosition: 'topRight',
                        colorbarLabelsPosition: 'outside',
                        maxZoom: null,
                        labelPosition: 'bottomLeft',
                        name: 'Rao et al. (2014) GM12878 MboI (allreps) 1kb'
                      },
                      uid: 'heatmap1',
                      name: 'Rao et al. (2014) GM12878 MboI (allreps) 1kb',
                      maxWidth: 4194304000,
                      binsPerDimension: 256,
                      maxZoom: 14
                    },
                    { 
                      type: '2d-chromosome-annotations', // or 2d-annotations?
                      chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',
                      options: {  
                        minRectWidth: 6,
                        minRectHeight: 6,
                        regions:[  
                           [  // chrom1, start1, end1, chrom2, start2, end2, color-fill, color-line, min-width, min-height
                              "chr1",
                              0,
                              200000000,
                              "chr1",
                              0,
                              200000000,
                              "rgba(255, 85, 0, 0.66)",
                              "rgba(255, 85, 0, 0.66)",
                              8, 8
                           ],
                        ]
                      }
                    },
                    {
                      type: '2d-chromosome-grid',
                      datatype: [
                        'chromosome-2d-grid'
                      ],
                      local: true,
                      orientation: '2d',
                      name: 'Chromosome Grid (hg19)',
                      chromInfoPath: '//s3.amazonaws.com/pkerp/data/hg19/chromSizes.tsv',
                      thumbnail: null,
                      uuid: 'TIlwFtqxTX-ndtM7Y9k1bw',
                      server: '',
                      tilesetUid: 'TIlwFtqxTX-ndtM7Y9k1bw',
                      serverUidKey: '/TIlwFtqxTX-ndtM7Y9k1bw',
                      uid: 'LUVqXXu2QYiO8XURIwyUyA',
                    }

                  ]
                }
              ],
            },
            layout: {
              w: 12,
              h: 12,
              x: 0,
              y: 0,
              i: 'aa',
              moved: false,
              static: false
            }
          }
        ],
        zoomLocks: {
          locksByViewUid: {},
          locksDict: {}
        },
        locationLocks: {
          locksByViewUid: {},
          locksDict: {}
        }
      };
    }

    function render(regions) {
      const viewConf = makeViewConf(regions);
      const hgApi = hglib.viewer(
        document.getElementById('development-demo'),
        viewConf,
        { bounded: true },
      );
    } 

    d3.csv('annotations-1d.csv', handleRow, render);
  }
)
</script>
</html>
